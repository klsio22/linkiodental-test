### Lab Orders API - Test Collection
### Base URL
@baseUrl = http://localhost:3000
@apiUrl = {{baseUrl}}/api

### Variables (update after creating an order)
@orderId = 67a1b2c3d4e5f6a7b8c9d0e1

###############################################################################
### HEALTH CHECK
###############################################################################

### Health Check
GET {{apiUrl}}/health HTTP/1.1

### Root Endpoint
GET {{baseUrl}}/ HTTP/1.1

###############################################################################
### CREATE ORDERS
###############################################################################

### Create Order - Success
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "João Silva",
  "dentistName": "Dr. Maria Santos",
  "services": ["Coroa de Porcelana", "Implante Dentário"],
  "totalValue": 2500.00,
  "deadline": "2026-02-20"
}

### Create Order - Multiple Services
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Ana Costa",
  "dentistName": "Dr. Pedro Lima",
  "services": ["Prótese Parcial", "Aparelho Ortodôntico", "Contenção"],
  "totalValue": 3200.50,
  "deadline": "2026-03-15"
}

### Create Order - Minimal
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Carlos Mendes",
  "dentistName": "Dra. Julia Ferreira",
  "services": ["Clareamento"],
  "totalValue": 800.00,
  "deadline": "2026-01-25"
}

### Create Order - Validation Error (missing patientName)
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "dentistName": "Dr. Test",
  "services": ["Test"],
  "totalValue": 100,
  "deadline": "2026-02-20"
}

### Create Order - Validation Error (empty services)
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Test Patient",
  "dentistName": "Dr. Test",
  "services": [],
  "totalValue": 100,
  "deadline": "2026-02-20"
}

### Create Order - Validation Error (invalid totalValue)
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Test Patient",
  "dentistName": "Dr. Test",
  "services": ["Test"],
  "totalValue": 0,
  "deadline": "2026-02-20"
}

### Create Order - Validation Error (past deadline)
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Test Patient",
  "dentistName": "Dr. Test",
  "services": ["Test"],
  "totalValue": 100,
  "deadline": "2020-01-01"
}

### Create Order - Validation Error (short name)
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Jo",
  "dentistName": "Dr. Test",
  "services": ["Test"],
  "totalValue": 100,
  "deadline": "2026-02-20"
}

###############################################################################
### LIST ORDERS
###############################################################################

### List All Orders (default pagination)
GET {{apiUrl}}/orders HTTP/1.1

### List Orders - Page 1, Limit 10
GET {{apiUrl}}/orders?page=1&limit=10 HTTP/1.1

### List Orders - Page 2
GET {{apiUrl}}/orders?page=2&limit=10 HTTP/1.1

### List Orders - Filter by State: CREATED
GET {{apiUrl}}/orders?state=CREATED HTTP/1.1

### List Orders - Filter by State: ANALYSIS
GET {{apiUrl}}/orders?state=ANALYSIS HTTP/1.1

### List Orders - Filter by State: COMPLETED
GET {{apiUrl}}/orders?state=COMPLETED HTTP/1.1

### List Orders - Filter by Patient Name
GET {{apiUrl}}/orders?patientName=João HTTP/1.1

### List Orders - Filter by Dentist Name
GET {{apiUrl}}/orders?dentistName=Maria HTTP/1.1

### List Orders - Multiple Filters
GET {{apiUrl}}/orders?state=CREATED&patientName=João&page=1&limit=5 HTTP/1.1

### List Orders - Sort by createdAt (descending - newest first)
GET {{apiUrl}}/orders?sortBy=createdAt&sortOrder=desc HTTP/1.1

### List Orders - Sort by createdAt (ascending - oldest first)
GET {{apiUrl}}/orders?sortBy=createdAt&sortOrder=asc HTTP/1.1

### List Orders - Sort by totalValue (descending)
GET {{apiUrl}}/orders?sortBy=totalValue&sortOrder=desc HTTP/1.1

### List Orders - Sort by patientName (alphabetically)
GET {{apiUrl}}/orders?sortBy=patientName&sortOrder=asc HTTP/1.1

### List Orders - Complex Query
GET {{apiUrl}}/orders?state=CREATED&sortBy=deadline&sortOrder=asc&page=1&limit=20 HTTP/1.1

###############################################################################
### GET ORDER BY ID
###############################################################################

### Get Order by ID (replace with real ID)
GET {{apiUrl}}/orders/{{orderId}} HTTP/1.1

### Get Order by ID - Not Found
GET {{apiUrl}}/orders/507f1f77bcf86cd799439011 HTTP/1.1

### Get Order by ID - Invalid ID Format
GET {{apiUrl}}/orders/invalid-id HTTP/1.1

###############################################################################
### UPDATE ORDERS
###############################################################################

### Update Order - Change Patient Name
PUT {{apiUrl}}/orders/{{orderId}} HTTP/1.1
Content-Type: application/json

{
  "patientName": "João Silva Junior"
}

### Update Order - Change Multiple Fields
PUT {{apiUrl}}/orders/{{orderId}} HTTP/1.1
Content-Type: application/json

{
  "patientName": "João da Silva",
  "services": ["Coroa de Porcelana", "Implante Dentário", "Prótese"],
  "totalValue": 3500.00
}

### Update Order - Change Deadline
PUT {{apiUrl}}/orders/{{orderId}} HTTP/1.1
Content-Type: application/json

{
  "deadline": "2026-03-30"
}

### Update Order - Try to Change State (should fail)
PUT {{apiUrl}}/orders/{{orderId}} HTTP/1.1
Content-Type: application/json

{
  "state": "COMPLETED"
}

### Update Order - Validation Error (invalid totalValue)
PUT {{apiUrl}}/orders/{{orderId}} HTTP/1.1
Content-Type: application/json

{
  "totalValue": -100
}

### Update Order - Not Found
PUT {{apiUrl}}/orders/507f1f77bcf86cd799439011 HTTP/1.1
Content-Type: application/json

{
  "patientName": "Test"
}

###############################################################################
### ADVANCE ORDER STATE
###############################################################################

### Advance State: CREATED → ANALYSIS
PATCH {{apiUrl}}/orders/{{orderId}}/advance HTTP/1.1

### Advance State: ANALYSIS → COMPLETED
# Run twice on same order to advance twice
PATCH {{apiUrl}}/orders/{{orderId}}/advance HTTP/1.1

### Advance State: COMPLETED (should fail - already final state)
# Run third time to see error
PATCH {{apiUrl}}/orders/{{orderId}}/advance HTTP/1.1

### Advance State - Not Found
PATCH {{apiUrl}}/orders/507f1f77bcf86cd799439011/advance HTTP/1.1

###############################################################################
### DELETE ORDERS
###############################################################################

### Delete Order
DELETE {{apiUrl}}/orders/{{orderId}} HTTP/1.1

### Delete Order - Not Found
DELETE {{apiUrl}}/orders/507f1f77bcf86cd799439011 HTTP/1.1

### Delete Order - Invalid ID
DELETE {{apiUrl}}/orders/invalid-id HTTP/1.1

###############################################################################
### STATISTICS
###############################################################################

### Get Order Statistics
GET {{apiUrl}}/orders/stats HTTP/1.1

###############################################################################
### WORKFLOW EXAMPLE
###############################################################################

### 1. Create a new order
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Workflow Test Patient",
  "dentistName": "Dr. Workflow Test",
  "services": ["Test Service"],
  "totalValue": 1000.00,
  "deadline": "2026-02-28"
}

# Copy the returned _id and update @orderId variable above

### 2. Get the created order
GET {{apiUrl}}/orders/{{orderId}} HTTP/1.1

### 3. Update the order
PUT {{apiUrl}}/orders/{{orderId}} HTTP/1.1
Content-Type: application/json

{
  "totalValue": 1200.00,
  "services": ["Test Service", "Additional Service"]
}

### 4. Advance to ANALYSIS
PATCH {{apiUrl}}/orders/{{orderId}}/advance HTTP/1.1

### 5. Advance to COMPLETED
PATCH {{apiUrl}}/orders/{{orderId}}/advance HTTP/1.1

### 6. Try to advance again (should fail)
PATCH {{apiUrl}}/orders/{{orderId}}/advance HTTP/1.1

### 7. Get statistics
GET {{apiUrl}}/orders/stats HTTP/1.1

### 8. Delete the order
DELETE {{apiUrl}}/orders/{{orderId}} HTTP/1.1

###############################################################################
### BULK TESTING
###############################################################################

### Create Multiple Orders for Testing
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Teste 001",
  "dentistName": "Dr. Teste",
  "services": ["Serviço A"],
  "totalValue": 500.00,
  "deadline": "2026-02-10"
}

###

POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Teste 002",
  "dentistName": "Dr. Teste",
  "services": ["Serviço B"],
  "totalValue": 750.00,
  "deadline": "2026-02-15"
}

###

POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Teste 003",
  "dentistName": "Dra. Teste",
  "services": ["Serviço C"],
  "totalValue": 1000.00,
  "deadline": "2026-02-20"
}

###############################################################################
### EDGE CASES
###############################################################################

### Very Long Name (should work)
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "José Antonio Carlos da Silva Santos Oliveira Junior",
  "dentistName": "Dr. Maria Aparecida dos Santos Ferreira Lima",
  "services": ["Tratamento Completo de Ortodontia com Aparelho Fixo"],
  "totalValue": 5000.00,
  "deadline": "2026-12-31"
}

### Maximum totalValue
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "VIP Patient",
  "dentistName": "Dr. Premium",
  "services": ["Full Mouth Rehabilitation"],
  "totalValue": 999999.99,
  "deadline": "2026-12-31"
}

### Minimum Valid totalValue
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Budget Patient",
  "dentistName": "Dr. Basic",
  "services": ["Consultation"],
  "totalValue": 0.01,
  "deadline": "2026-02-01"
}

### Many Services
POST {{apiUrl}}/orders HTTP/1.1
Content-Type: application/json

{
  "patientName": "Complex Case",
  "dentistName": "Dr. Specialist",
  "services": [
    "Implante",
    "Coroa",
    "Prótese",
    "Clareamento",
    "Limpeza",
    "Canal",
    "Extração",
    "Aparelho"
  ],
  "totalValue": 15000.00,
  "deadline": "2026-06-30"
}
